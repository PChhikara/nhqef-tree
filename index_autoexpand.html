
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>NHQEF Tree (Auto Expand)</title>
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      margin: 0;
      background: #f9fafb;
      padding: 1rem;
    }
    .node circle {
      fill: #6366f1;
      cursor: pointer;
    }
    .node text {
      font-size: 13px;
      fill: #1e293b;
    }
    .tooltip {
      position: absolute;
      background-color: white;
      border: 1px solid #ccc;
      padding: 10px;
      border-radius: 5px;
      pointer-events: none;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
      font-size: 14px;
      max-width: 300px;
    }
  </style>
</head>
<body>
  <h2>🌳 NHQEF Graduate Attributes Tree</h2>
  <svg width="1000" height="800"></svg>
  <div class="tooltip" style="opacity:0;"></div>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script>
    const data = {
      "name": "NHQEF Graduate Attributes",
      "children": [
        { "name": "🧠 Knowledge", "children": [
          { "name": "KWLG-CNCPT", "definition": "Conceptual Knowledge: Understanding of concepts, theories, principles.", "example": "Explain key ideas in calculus including limits and differentiation." },
          { "name": "KWLG-PRCDR", "definition": "Procedural Knowledge: Use procedures and methods.", "example": "Use integration by parts to evaluate integrals." },
          { "name": "KWLG-LINK", "definition": "Interdisciplinary Linkages: Make connections across disciplines.", "example": "Link statistical models with economic predictions." }
        ]},
        { "name": "⚙️ Skills", "children": [
          { "name": "SKILL-TASK", "definition": "Perform technical tasks.", "example": "Solve differential equations using numerical methods." },
          { "name": "SKILL-ANALYZE", "definition": "Analyze and synthesize information.", "example": "Compare the growth rates of algorithms." }
        ]},
        { "name": "🧩 Application", "children": [
          { "name": "APPL-KNOW", "definition": "Apply knowledge to real-world problems.", "example": "Use physics laws to solve engineering problems." }
        ]},
        { "name": "💬 Generic Skills", "children": [
          { "name": "GEN-COMM-WRITE", "definition": "Write clearly for various audiences.", "example": "Write a lab report summarizing scientific data." }
        ]},
        { "name": "🧑‍💼 Employability", "children": [
          { "name": "EMP-OWN", "definition": "Take responsibility for your work.", "example": "Meet project deadlines and report progress." }
        ]},
        { "name": "🌍 Ethics & Values", "children": [
          { "name": "ETHIC-PRACTICE-ETHIC", "definition": "Academic honesty, fairness.", "example": "Cite sources properly to avoid plagiarism." }
        ]}
      ]
    };

    const width = 1000, dx = 20, dy = width / 6;
    const tree = d3.tree().nodeSize([dx, dy]);
    const diagonal = d3.linkHorizontal().x(d => d.y).y(d => d.x);
    const margin = {top: 20, right: 120, bottom: 20, left: 100};

    const root = d3.hierarchy(data);
    root.x0 = dy / 2;
    root.y0 = 0;

    // Auto-expand first level
    root.children.forEach(d => {
      d._children = d.children;
      d.children = d._children;
    });

    const svg = d3.select("svg")
      .attr("viewBox", [-margin.left, -margin.top, width, dx])
      .style("font", "10px sans-serif");

    const gLink = svg.append("g")
      .attr("fill", "none")
      .attr("stroke", "#ccc")
      .attr("stroke-opacity", 0.8)
      .attr("stroke-width", 1.5);

    const gNode = svg.append("g").attr("cursor", "pointer");
    const tooltip = d3.select(".tooltip");

    function update(source) {
      const nodes = root.descendants().reverse();
      const links = root.links();
      tree(root);

      let left = root, right = root;
      root.eachBefore(node => {
        if (node.x < left.x) left = node;
        if (node.x > right.x) right = node;
      });

      const height = right.x - left.x + margin.top + margin.bottom;
      svg.attr("viewBox", [-margin.left, left.x - margin.top, width, height]);

      const node = gNode.selectAll("g").data(nodes, d => d.id || (d.id = ++i));
      const nodeEnter = node.enter().append("g")
        .attr("transform", d => `translate(${source.y0},${source.x0})`)
        .on("click", (event, d) => {
          d.children = d.children ? null : d._children;
          update(d);
        })
        .on("mouseover", (event, d) => {
          if (d.data.definition) {
            tooltip.transition().duration(200).style("opacity", .9);
            tooltip.html(`<strong>${d.data.name}</strong><br>${d.data.definition}<br>💡 <em>${d.data.example}</em>`)
              .style("left", (event.pageX + 10) + "px")
              .style("top", (event.pageY - 28) + "px");
          }
        })
        .on("mouseout", () => tooltip.transition().duration(300).style("opacity", 0));

      nodeEnter.append("circle")
        .attr("r", 4)
        .attr("fill", d => d._children ? "#6366f1" : "#94a3b8");

      nodeEnter.append("text")
        .attr("dy", "0.31em")
        .attr("x", d => d._children ? -6 : 6)
        .attr("text-anchor", d => d._children ? "end" : "start")
        .text(d => d.data.name)
        .clone(true).lower()
        .attr("stroke", "white")
        .attr("stroke-width", 3);

      node.merge(nodeEnter).transition().attr("transform", d => `translate(${d.y},${d.x})`);
      node.exit().transition().remove();

      const link = gLink.selectAll("path").data(links, d => d.target.id);
      link.enter().append("path")
        .attr("d", d => {
          const o = {x: source.x0, y: source.y0};
          return diagonal({source: o, target: o});
        })
        .merge(link).transition().attr("d", diagonal);
      link.exit().transition().remove();

      root.eachBefore(d => { d.x0 = d.x; d.y0 = d.y; });
    }

    let i = 0;
    update(root);
  </script>
</body>
</html>
